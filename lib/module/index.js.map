{"version":3,"sources":["index.tsx"],"names":["React","useCallback","useEffect","useImperativeHandle","useRef","useState","Image","Platform","StyleSheet","useWindowDimensions","View","Animated","useAnimatedGestureHandler","useAnimatedStyle","useDerivedValue","useSharedValue","withTiming","withDecay","useAnimatedReaction","runOnJS","withSpring","cancelAnimation","PanGestureHandler","PinchGestureHandler","TapGestureHandler","useVector","clamp","withDecaySpring","withRubberBandClamp","DOUBLE_TAP_SCALE","MAX_SCALE","SPACE_BETWEEN_IMAGES","isAndroid","OS","useRefs","pan","tap","doubleTap","pinch","snapPoint","value","velocity","points","point","deltas","map","p","Math","abs","minDelta","min","apply","filter","defaultRenderImage","item","setImageDimensions","e","height","h","width","w","nativeEvent","source","uri","absoluteFillObject","ResizableImage","memo","translateX","index","isFirst","isLast","currentIndex","renderItem","onSwipeToClose","onTap","onDoubleTap","onPanStart","onScaleStart","emptySpaceWidth","doubleTapScale","maxScale","disableTransitionOnScaledImage","hideAdjacentImagesOnScaledImage","disableVerticalSwipe","loop","length","onScaleChange","onScaleChangeRange","setRef","disablePinchToZoom","CENTER","x","y","pinchActive","panActive","offset","scale","translation","origin","adjustedFocal","originalLayout","layout","isActive","scaleReaction","start","end","setAdjustedFocal","focalX","focalY","resetValues","animated","getEdgeX","newWidth","clampY","newScale","newHeight","clampX","getEdgeY","onStart","getPosition","i","getIndexFromPosition","position","round","gestureHandler","ctx","androidPinchActivated","scaleOffset","onActive","s","numberOfPointers","nextScale","onFinish","_","sc","nextTransX","nextTransY","diffX","moved","diffY","singleTapHandler","doubleTapHandler","panHandler","velocityY","velocityX","isVertical","initialTranslateX","translationX","translationY","clampedX","disabledTransition","moveX","edgeY","shouldClose","edgeX","some","snapPoints","snapTo","nextIndex","damping","mass","stiffness","restDisplacementThreshold","restSpeedThreshold","moveTo","currentScale","translateIndex","diff","reset","animatedStyle","isNextForLast","isPrevForFirst","transform","translateY","portrait","imageHeight","imageWidth","itemProps","GalleryComponent","data","initialIndex","numToRender","onIndexChange","style","keyExtractor","containerDimensions","eventsCallbacks","ref","windowDimensions","dimensions","isLoop","setIndex","refs","current","changeIndex","newIndex","forEach","itemRef","flex","backgroundColor","flexDirection","outOfLoopRenderRange","hidden","id","key","_id","marginLeft","zIndex","Gallery","forwardRef"],"mappings":"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","sourcesContent":["import React, {\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from 'react';\nimport {\n  Image,\n  Platform,\n  StyleSheet,\n  useWindowDimensions,\n  View,\n  ViewStyle,\n} from 'react-native';\nimport Animated, {\n  useAnimatedGestureHandler,\n  useAnimatedStyle,\n  useDerivedValue,\n  useSharedValue,\n  withTiming,\n  withDecay,\n  useAnimatedReaction,\n  runOnJS,\n  withSpring,\n  cancelAnimation,\n} from 'react-native-reanimated';\nimport {\n  GestureEvent,\n  PanGestureHandler,\n  PanGestureHandlerEventPayload,\n  PinchGestureHandler,\n  PinchGestureHandlerEventPayload,\n  TapGestureHandler,\n  TapGestureHandlerEventPayload,\n} from 'react-native-gesture-handler';\nimport { useVector } from 'react-native-redash';\nimport { clamp, withDecaySpring, withRubberBandClamp } from './utils';\n\nconst DOUBLE_TAP_SCALE = 3;\nconst MAX_SCALE = 6;\nconst SPACE_BETWEEN_IMAGES = 40;\n\nconst isAndroid = Platform.OS === 'android';\n\nconst useRefs = () => {\n  const pan = useRef();\n  const tap = useRef();\n  const doubleTap = useRef();\n  const pinch = useRef<PinchGestureHandler>();\n\n  return {\n    pan,\n    tap,\n    doubleTap,\n    pinch,\n  };\n};\n\ntype Dimensions = {\n  height: number;\n  width: number;\n};\n\nexport const snapPoint = (\n  value: number,\n  velocity: number,\n  points: ReadonlyArray<number>\n): number => {\n  'worklet';\n  const point = value + 0.25 * velocity;\n  const deltas = points.map((p) => Math.abs(point - p));\n  const minDelta = Math.min.apply(null, deltas);\n  return points.filter((p) => Math.abs(point - p) === minDelta)[0];\n};\n\nexport type RenderItemInfo<T> = {\n  index: number;\n  item: T;\n  setImageDimensions: (imageDimensions: Dimensions) => void;\n};\n\nconst defaultRenderImage = ({\n  item,\n  setImageDimensions,\n}: RenderItemInfo<any>) => {\n  return (\n    <Image\n      onLoad={(e) => {\n        const { height: h, width: w } = e.nativeEvent.source;\n        setImageDimensions({ height: h, width: w });\n      }}\n      source={{ uri: item }}\n      resizeMode=\"contain\"\n      style={StyleSheet.absoluteFillObject}\n    />\n  );\n};\n\ntype EventsCallbacks = {\n  onSwipeToClose?: () => void;\n  onTap?: () => void;\n  onDoubleTap?: () => void;\n  onScaleStart?: () => void;\n  onPanStart?: () => void;\n};\n\ntype RenderItem<T> = (\n  imageInfo: RenderItemInfo<T>\n) => React.ReactElement | null;\n\ntype Props<T> = EventsCallbacks & {\n  item: T;\n  index: number;\n  isFirst: boolean;\n  isLast: boolean;\n  translateX: Animated.SharedValue<number>;\n  currentIndex: Animated.SharedValue<number>;\n  renderItem: RenderItem<T>;\n  width: number;\n  height: number;\n  length: number;\n  emptySpaceWidth: number;\n  doubleTapScale: number;\n  maxScale: number;\n  disableTransitionOnScaledImage: boolean;\n  hideAdjacentImagesOnScaledImage: boolean;\n  disableVerticalSwipe: boolean;\n  loop: boolean;\n  onScaleChange?: (scale: number) => void;\n  onScaleChangeRange?: { start: number; end: number };\n  setRef: (index: number, value: ItemRef) => void;\n  disablePinchToZoom: boolean;\n};\n\ntype ItemRef = { reset: (animated: boolean) => void };\n\nconst ResizableImage = React.memo(\n  <T extends any>({\n    item,\n    translateX,\n    index,\n    isFirst,\n    isLast,\n    currentIndex,\n    renderItem,\n    width,\n    height,\n    onSwipeToClose,\n    onTap,\n    onDoubleTap,\n    onPanStart,\n    onScaleStart,\n    emptySpaceWidth,\n    doubleTapScale,\n    maxScale,\n    disableTransitionOnScaledImage,\n    hideAdjacentImagesOnScaledImage,\n    disableVerticalSwipe,\n    loop,\n    length,\n    onScaleChange,\n    onScaleChangeRange,\n    setRef,\n    disablePinchToZoom,\n  }: Props<T>) => {\n    const CENTER = {\n      x: width / 2,\n      y: height / 2,\n    };\n\n    const { pinch, tap, doubleTap, pan } = useRefs();\n\n    const pinchActive = useSharedValue(false);\n\n    const panActive = useSharedValue(false);\n\n    const offset = useVector(0, 0);\n\n    const scale = useSharedValue(1);\n\n    const translation = useVector(0, 0);\n\n    const origin = useVector(0, 0);\n\n    const adjustedFocal = useVector(0, 0);\n\n    const originalLayout = useVector(width, 0);\n    const layout = useVector(width, 0);\n\n    const isActive = useDerivedValue(() => currentIndex.value === index);\n\n    useAnimatedReaction(\n      () => {\n        return scale.value;\n      },\n      (scaleReaction) => {\n        if (!onScaleChange) {\n          return;\n        }\n\n        if (!onScaleChangeRange) {\n          runOnJS(onScaleChange)(scaleReaction);\n          return;\n        }\n\n        if (\n          scaleReaction > onScaleChangeRange.start &&\n          scaleReaction < onScaleChangeRange.end\n        ) {\n          runOnJS(onScaleChange)(scaleReaction);\n        }\n      }\n    );\n\n    const setAdjustedFocal = ({\n      focalX,\n      focalY,\n    }: Record<'focalX' | 'focalY', number>) => {\n      'worklet';\n\n      adjustedFocal.x.value = focalX - (CENTER.x + offset.x.value);\n      adjustedFocal.y.value = focalY - (CENTER.y + offset.y.value);\n    };\n\n    const resetValues = (animated = true) => {\n      'worklet';\n\n      scale.value = animated ? withTiming(1) : 1;\n      offset.x.value = animated ? withTiming(0) : 0;\n      offset.y.value = animated ? withTiming(0) : 0;\n      translation.x.value = animated ? withTiming(0) : 0;\n      translation.y.value = animated ? withTiming(0) : 0;\n    };\n\n    const getEdgeX = () => {\n      'worklet';\n      const newWidth = scale.value * layout.x.value;\n\n      const point = (newWidth - width) / 2;\n\n      if (point < 0) {\n        return [-0, 0];\n      }\n\n      return [-point, point];\n    };\n\n    const clampY = (value: number, newScale: number) => {\n      'worklet';\n      const newHeight = newScale * layout.y.value;\n      const point = (newHeight - height) / 2;\n\n      if (newHeight < height) {\n        return 0;\n      }\n      return clamp(value, -point, point);\n    };\n\n    const clampX = (value: number, newScale: number) => {\n      'worklet';\n      const newWidth = newScale * layout.x.value;\n      const point = (newWidth - width) / 2;\n\n      if (newWidth < width) {\n        return 0;\n      }\n      return clamp(value, -point, point);\n    };\n\n    const getEdgeY = () => {\n      'worklet';\n\n      const newHeight = scale.value * layout.y.value;\n\n      const point = (newHeight - height) / 2;\n\n      return [-point, point];\n    };\n\n    const onStart = () => {\n      'worklet';\n\n      cancelAnimation(translateX);\n\n      offset.x.value = offset.x.value + translation.x.value;\n      offset.y.value = offset.y.value + translation.y.value;\n\n      translation.x.value = 0;\n      translation.y.value = 0;\n    };\n\n    const getPosition = (i?: number) => {\n      'worklet';\n\n      return (\n        -(width + emptySpaceWidth) * (typeof i !== 'undefined' ? i : index)\n      );\n    };\n\n    const getIndexFromPosition = (position: number) => {\n      'worklet';\n\n      return Math.round(position / -(width + emptySpaceWidth));\n    };\n\n    const gestureHandler = useAnimatedGestureHandler<\n      GestureEvent<PinchGestureHandlerEventPayload>,\n      {\n        scaleOffset: number;\n        androidPinchActivated: boolean;\n      }\n    >(\n      {\n        onStart: ({ focalX, focalY }, ctx) => {\n          if (!isActive.value) return;\n          if (panActive.value && !isAndroid) return;\n\n          pinchActive.value = true;\n\n          if (onScaleStart) {\n            runOnJS(onScaleStart)();\n          }\n\n          if (isAndroid) {\n            ctx.androidPinchActivated = false;\n          }\n\n          onStart();\n\n          ctx.scaleOffset = scale.value;\n\n          setAdjustedFocal({ focalX, focalY });\n\n          origin.x.value = adjustedFocal.x.value;\n          origin.y.value = adjustedFocal.y.value;\n        },\n        onActive: ({ scale: s, focalX, focalY, numberOfPointers }, ctx) => {\n          if (disablePinchToZoom) return;\n          if (!isActive.value) return;\n          if (numberOfPointers !== 2 && !isAndroid) return;\n          if (panActive.value && !isAndroid) return;\n\n          if (!ctx.androidPinchActivated && isAndroid) {\n            setAdjustedFocal({ focalX, focalY });\n\n            origin.x.value = adjustedFocal.x.value;\n            origin.y.value = adjustedFocal.y.value;\n\n            ctx.androidPinchActivated = true;\n          }\n\n          const nextScale = withRubberBandClamp(\n            s * ctx.scaleOffset,\n            0.55,\n            maxScale,\n            [1, maxScale]\n          );\n\n          scale.value = nextScale;\n\n          setAdjustedFocal({ focalX, focalY });\n\n          translation.x.value =\n            adjustedFocal.x.value +\n            ((-1 * nextScale) / ctx.scaleOffset) * origin.x.value;\n          translation.y.value =\n            adjustedFocal.y.value +\n            ((-1 * nextScale) / ctx.scaleOffset) * origin.y.value;\n        },\n        onFinish: (_, ctx) => {\n          if (!isActive.value) return;\n\n          pinchActive.value = false;\n\n          if (scale.value < 1) {\n            resetValues();\n          } else {\n            const sc = Math.min(scale.value, maxScale);\n\n            const newWidth = sc * layout.x.value;\n            const newHeight = sc * layout.y.value;\n\n            const nextTransX =\n              scale.value > maxScale\n                ? adjustedFocal.x.value +\n                  ((-1 * maxScale) / ctx.scaleOffset) * origin.x.value\n                : translation.x.value;\n\n            const nextTransY =\n              scale.value > maxScale\n                ? adjustedFocal.y.value +\n                  ((-1 * maxScale) / ctx.scaleOffset) * origin.y.value\n                : translation.y.value;\n\n            const diffX = nextTransX + offset.x.value - (newWidth - width) / 2;\n\n            if (scale.value > maxScale) {\n              scale.value = withTiming(maxScale);\n            }\n\n            if (newWidth <= width) {\n              translation.x.value = withTiming(0);\n            } else {\n              let moved;\n              if (diffX > 0) {\n                translation.x.value = withTiming(nextTransX - diffX);\n                moved = true;\n              }\n\n              if (newWidth + diffX < width) {\n                translation.x.value = withTiming(\n                  nextTransX + width - (newWidth + diffX)\n                );\n                moved = true;\n              }\n              if (!moved) {\n                translation.x.value = withTiming(nextTransX);\n              }\n            }\n\n            const diffY =\n              nextTransY + offset.y.value - (newHeight - height) / 2;\n\n            if (newHeight <= height) {\n              translation.y.value = withTiming(-offset.y.value);\n            } else {\n              let moved;\n              if (diffY > 0) {\n                translation.y.value = withTiming(nextTransY - diffY);\n                moved = true;\n              }\n\n              if (newHeight + diffY < height) {\n                translation.y.value = withTiming(\n                  nextTransY + height - (newHeight + diffY)\n                );\n                moved = true;\n              }\n              if (!moved) {\n                translation.y.value = withTiming(nextTransY);\n              }\n            }\n          }\n        },\n      },\n      [layout.x, layout.y, index, isFirst, isLast, width, height]\n    );\n\n    const singleTapHandler = useAnimatedGestureHandler<\n      GestureEvent<TapGestureHandlerEventPayload>\n    >({\n      onActive: () => {\n        if (onTap) {\n          runOnJS(onTap)();\n        }\n      },\n    });\n\n    const doubleTapHandler = useAnimatedGestureHandler<\n      GestureEvent<TapGestureHandlerEventPayload>\n    >({\n      onActive: ({ x, y, numberOfPointers }) => {\n        if (!isActive.value) return;\n        if (numberOfPointers !== 1) return;\n\n        if (onDoubleTap) {\n          runOnJS(onDoubleTap)();\n        }\n\n        if (scale.value === 1) {\n          scale.value = withTiming(doubleTapScale);\n\n          setAdjustedFocal({ focalX: x, focalY: y });\n\n          offset.x.value = withTiming(\n            clampX(\n              adjustedFocal.x.value +\n                -1 * doubleTapScale * adjustedFocal.x.value,\n              doubleTapScale\n            )\n          );\n          offset.y.value = withTiming(\n            clampY(\n              adjustedFocal.y.value +\n                -1 * doubleTapScale * adjustedFocal.y.value,\n              doubleTapScale\n            )\n          );\n        } else {\n          resetValues();\n        }\n      },\n    });\n\n    const panHandler = useAnimatedGestureHandler<\n      GestureEvent<PanGestureHandlerEventPayload>,\n      {\n        scaleOffset: number;\n        initialTranslateX: number;\n        isVertical: boolean;\n        shouldClose: boolean;\n      }\n    >(\n      {\n        onStart: ({ velocityY, velocityX }, ctx) => {\n          if (!isActive.value) return;\n          if (pinchActive.value && !isAndroid) return;\n\n          panActive.value = true;\n\n          if (onPanStart) {\n            runOnJS(onPanStart)();\n          }\n\n          onStart();\n          ctx.isVertical = Math.abs(velocityY) > Math.abs(velocityX);\n          ctx.initialTranslateX = translateX.value;\n        },\n        onActive: ({ translationX, translationY, velocityY }, ctx) => {\n          if (!isActive.value) return;\n          if (pinchActive.value && !isAndroid) return;\n          if (disableVerticalSwipe && scale.value === 1 && ctx.isVertical)\n            return;\n\n          const x = getEdgeX();\n\n          if (!ctx.isVertical || scale.value > 1) {\n            const clampedX = clamp(\n              translationX,\n              x[0] - offset.x.value,\n              x[1] - offset.x.value\n            );\n\n            if (\n              hideAdjacentImagesOnScaledImage &&\n              disableTransitionOnScaledImage\n            ) {\n              const disabledTransition =\n                disableTransitionOnScaledImage && scale.value > 1;\n\n              const moveX = withRubberBandClamp(\n                ctx.initialTranslateX + translationX - clampedX,\n                0.55,\n                width,\n                disabledTransition\n                  ? [getPosition(index), getPosition(index + 1)]\n                  : [getPosition(length - 1), 0]\n              );\n\n              if (!disabledTransition) {\n                translateX.value = moveX;\n              }\n              if (disabledTransition) {\n                translation.x.value = clampedX + moveX - translateX.value;\n              } else {\n                translation.x.value = clampedX;\n              }\n            } else {\n              if (loop) {\n                translateX.value =\n                  ctx.initialTranslateX + translationX - clampedX;\n              } else {\n                translateX.value = withRubberBandClamp(\n                  ctx.initialTranslateX + translationX - clampedX,\n                  0.55,\n                  width,\n                  disableTransitionOnScaledImage && scale.value > 1\n                    ? [getPosition(index), getPosition(index + 1)]\n                    : [getPosition(length - 1), 0]\n                );\n              }\n              translation.x.value = clampedX;\n            }\n          }\n\n          const newHeight = scale.value * layout.y.value;\n\n          const edgeY = getEdgeY();\n\n          if (newHeight > height) {\n            translation.y.value = withRubberBandClamp(\n              translationY,\n              0.55,\n              newHeight,\n              [edgeY[0] - offset.y.value, edgeY[1] - offset.y.value]\n            );\n          } else if (\n            !(scale.value === 1 && translateX.value !== getPosition())\n          ) {\n            translation.y.value = translationY;\n          }\n\n          if (ctx.isVertical && newHeight <= height) {\n            ctx.shouldClose = Math.abs(translationY + velocityY * 0.2) > 220;\n          }\n        },\n        onFinish: ({ velocityX, velocityY }, ctx) => {\n          if (!isActive.value) return;\n\n          panActive.value = false;\n\n          const newHeight = scale.value * layout.y.value;\n\n          const edgeX = getEdgeX();\n\n          if (\n            Math.abs(translateX.value - getPosition()) >= 0 &&\n            edgeX.some((x) => x === translation.x.value + offset.x.value)\n          ) {\n            let snapPoints = [index - 1, index, index + 1]\n              .filter((_, y) => {\n                if (loop) return true;\n\n                if (y === 0) {\n                  return !isFirst;\n                }\n                if (y === 2) {\n                  return !isLast;\n                }\n                return true;\n              })\n              .map((i) => getPosition(i));\n\n            if (disableTransitionOnScaledImage && scale.value > 1) {\n              snapPoints = [getPosition(index)];\n            }\n\n            let snapTo = snapPoint(translateX.value, velocityX, snapPoints);\n\n            const nextIndex = getIndexFromPosition(snapTo);\n\n            if (currentIndex.value !== nextIndex) {\n              if (loop) {\n                if (nextIndex === length) {\n                  currentIndex.value = 0;\n                  translateX.value = translateX.value - getPosition(length);\n                  snapTo = 0;\n                } else if (nextIndex === -1) {\n                  currentIndex.value = length - 1;\n                  translateX.value = translateX.value + getPosition(length);\n                  snapTo = getPosition(length - 1);\n                } else {\n                  currentIndex.value = nextIndex;\n                }\n              } else {\n                currentIndex.value = nextIndex;\n              }\n            }\n\n            translateX.value = withSpring(snapTo, {\n              damping: 800,\n              mass: 1,\n              stiffness: 250,\n              restDisplacementThreshold: 0.02,\n              restSpeedThreshold: 4,\n            });\n          } else {\n            const newWidth = scale.value * layout.x.value;\n\n            offset.x.value = withDecaySpring({\n              velocity: velocityX,\n              clamp: [\n                -(newWidth - width) / 2 - translation.x.value,\n                (newWidth - width) / 2 - translation.x.value,\n              ],\n            });\n          }\n\n          if (onSwipeToClose && ctx.shouldClose) {\n            offset.y.value = withDecay({\n              velocity: velocityY,\n            });\n            runOnJS(onSwipeToClose)();\n            return;\n          }\n\n          if (newHeight > height) {\n            offset.y.value = withDecaySpring({\n              velocity: velocityY,\n              clamp: [\n                -(newHeight - height) / 2 - translation.y.value,\n                (newHeight - height) / 2 - translation.y.value,\n              ],\n            });\n          } else {\n            const diffY =\n              translation.y.value + offset.y.value - (newHeight - height) / 2;\n\n            if (newHeight <= height && diffY !== height - diffY - newHeight) {\n              const moveTo = diffY - (height - newHeight) / 2;\n\n              translation.y.value = withTiming(translation.y.value - moveTo);\n            }\n          }\n        },\n      },\n      [layout.x, layout.y, index, isFirst, isLast, loop, width, height]\n    );\n\n    useAnimatedReaction(\n      () => {\n        return {\n          i: currentIndex.value,\n          translateX: translateX.value,\n          currentScale: scale.value,\n        };\n      },\n      ({ i, translateX, currentScale }) => {\n        const translateIndex = translateX / -(width + emptySpaceWidth);\n        if (loop) {\n          let diff = Math.abs((translateIndex % 1) - 0.5);\n          if (diff > 0.5) {\n            diff = 1 - diff;\n          }\n          if (diff > 0.48 && Math.abs(i) !== index) {\n            resetValues(false);\n            return;\n          }\n        }\n        if (Math.abs(i - index) === 2 && currentScale > 1) {\n          resetValues(false);\n        }\n      }\n    );\n\n    useEffect(() => {\n      setRef(index, {\n        reset: (animated: boolean) => resetValues(animated),\n      });\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [index]);\n\n    const animatedStyle = useAnimatedStyle(() => {\n      const isNextForLast =\n        loop &&\n        isFirst &&\n        currentIndex.value === length - 1 &&\n        translateX.value < getPosition(length - 1);\n      const isPrevForFirst =\n        loop &&\n        isLast &&\n        currentIndex.value === 0 &&\n        translateX.value > getPosition(0);\n      return {\n        transform: [\n          {\n            translateX:\n              offset.x.value +\n              translation.x.value -\n              (isNextForLast ? getPosition(length) : 0) +\n              (isPrevForFirst ? getPosition(length) : 0),\n          },\n          { translateY: offset.y.value + translation.y.value },\n          { scale: scale.value },\n        ],\n      };\n    });\n\n    const setImageDimensions: RenderItemInfo<T>['setImageDimensions'] = ({\n      width: w,\n      height: h,\n    }) => {\n      originalLayout.x.value = w;\n      originalLayout.y.value = h;\n\n      const portrait = width > height;\n\n      if (portrait) {\n        const imageHeight = Math.min((h * width) / w, height);\n        layout.y.value = imageHeight;\n        if (imageHeight === height) {\n          layout.x.value = (w * height) / h;\n        }\n      } else {\n        const imageWidth = Math.min((w * height) / h, width);\n        layout.x.value = imageWidth;\n        if (imageWidth === width) {\n          layout.y.value = (h * width) / w;\n        }\n      }\n    };\n\n    useEffect(() => {\n      setImageDimensions({\n        width: originalLayout.x.value,\n        height: originalLayout.y.value,\n      });\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [width, height]);\n\n    const itemProps: RenderItemInfo<T> = {\n      item,\n      index,\n      setImageDimensions,\n    };\n\n    return (\n      <PanGestureHandler\n        ref={pan}\n        onGestureEvent={panHandler}\n        minDist={10}\n        minPointers={1}\n        maxPointers={1}\n      >\n        <Animated.View style={[{ width, height }]}>\n          <PinchGestureHandler\n            ref={pinch}\n            simultaneousHandlers={[pan]}\n            onGestureEvent={gestureHandler}\n            minPointers={2}\n          >\n            <Animated.View style={{ width, height }}>\n              <TapGestureHandler\n                ref={doubleTap}\n                onGestureEvent={singleTapHandler}\n                waitFor={tap}\n                maxDeltaX={10}\n                maxDeltaY={10}\n              >\n                <Animated.View style={[{ width, height }, animatedStyle]}>\n                  <TapGestureHandler\n                    ref={tap}\n                    onGestureEvent={doubleTapHandler}\n                    numberOfTaps={2}\n                  >\n                    <Animated.View style={{ width, height }}>\n                      {renderItem(itemProps)}\n                    </Animated.View>\n                  </TapGestureHandler>\n                </Animated.View>\n              </TapGestureHandler>\n            </Animated.View>\n          </PinchGestureHandler>\n        </Animated.View>\n      </PanGestureHandler>\n    );\n  }\n);\n\nexport type GalleryRef = {\n  setIndex: (newIndex: number) => void;\n  reset: (animated?: boolean) => void;\n};\n\nexport type GalleryReactRef = React.Ref<GalleryRef>;\n\ntype GalleryProps<T> = EventsCallbacks & {\n  ref?: GalleryReactRef;\n  data: T[];\n  renderItem?: RenderItem<T>;\n  keyExtractor?: (item: T, index: number) => string | number;\n  initialIndex?: number;\n  onIndexChange?: (index: number) => void;\n  numToRender?: number;\n  emptySpaceWidth?: number;\n  doubleTapScale?: number;\n  maxScale?: number;\n  style?: ViewStyle;\n  containerDimensions?: { width: number; height: number };\n  disableTransitionOnScaledImage?: boolean;\n  hideAdjacentImagesOnScaledImage?: boolean;\n  disableVerticalSwipe?: boolean;\n  loop?: boolean;\n  onScaleChange?: (scale: number) => void;\n  onScaleChangeRange?: { start: number; end: number };\n  disablePinchToZoom?: boolean;\n};\n\nconst GalleryComponent = <T extends any>(\n  {\n    data,\n    renderItem = defaultRenderImage,\n    initialIndex = 0,\n    numToRender = 5,\n    emptySpaceWidth = SPACE_BETWEEN_IMAGES,\n    doubleTapScale = DOUBLE_TAP_SCALE,\n    maxScale = MAX_SCALE,\n    disableTransitionOnScaledImage = false,\n    hideAdjacentImagesOnScaledImage = false,\n    onIndexChange,\n    style,\n    keyExtractor,\n    containerDimensions,\n    disableVerticalSwipe,\n    loop = false,\n    onScaleChange,\n    onScaleChangeRange,\n    disablePinchToZoom = false,\n    ...eventsCallbacks\n  }: GalleryProps<T>,\n  ref: GalleryReactRef\n) => {\n  const windowDimensions = useWindowDimensions();\n  const dimensions = containerDimensions || windowDimensions;\n\n  const isLoop = loop && data?.length > 1;\n\n  const [index, setIndex] = useState(initialIndex);\n\n  const refs = useRef<ItemRef[]>([]);\n\n  const setRef = useCallback((index: number, value: ItemRef) => {\n    refs.current[index] = value;\n  }, []);\n\n  const translateX = useSharedValue(\n    initialIndex * -(dimensions.width + emptySpaceWidth)\n  );\n\n  const currentIndex = useSharedValue(initialIndex);\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ translateX: translateX.value }],\n  }));\n\n  const changeIndex = useCallback(\n    (newIndex) => {\n      onIndexChange?.(newIndex);\n      setIndex(newIndex);\n    },\n    [onIndexChange, setIndex]\n  );\n\n  useAnimatedReaction(\n    () => currentIndex.value,\n    (newIndex) => runOnJS(changeIndex)(newIndex),\n    [currentIndex]\n  );\n\n  useEffect(() => {\n    translateX.value = index * -(dimensions.width + emptySpaceWidth);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [windowDimensions]);\n\n  useImperativeHandle(ref, () => ({\n    setIndex(newIndex: number) {\n      setIndex(newIndex);\n      currentIndex.value = newIndex;\n      translateX.value = newIndex * -(dimensions.width + emptySpaceWidth);\n    },\n    reset(animated = false) {\n      refs.current?.forEach((itemRef) => itemRef.reset(animated));\n    },\n  }));\n\n  useEffect(() => {\n    if (index >= data.length) {\n      const newIndex = data.length - 1;\n      setIndex(newIndex);\n      currentIndex.value = newIndex;\n      translateX.value = newIndex * -(dimensions.width + emptySpaceWidth);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [data?.length]);\n\n  return (\n    <View style={[{ flex: 1, backgroundColor: 'black' }, style]}>\n      <Animated.View style={[{ flex: 1, flexDirection: 'row' }, animatedStyle]}>\n        {data.map((item: any, i) => {\n          const isFirst = i === 0;\n\n          const outOfLoopRenderRange =\n            !isLoop ||\n            (Math.abs(i - index) < data.length - (numToRender - 1) / 2 &&\n              Math.abs(i - index) > (numToRender - 1) / 2);\n\n          const hidden =\n            Math.abs(i - index) > (numToRender - 1) / 2 && outOfLoopRenderRange;\n\n          return (\n            <View\n              key={\n                keyExtractor\n                  ? keyExtractor(item, i)\n                  : item.id || item.key || item._id || item\n              }\n              style={[\n                dimensions,\n                isFirst ? {} : { marginLeft: emptySpaceWidth },\n                { zIndex: index === i ? 1 : 0 },\n              ]}\n            >\n              {hidden ? null : (\n                // @ts-ignore\n                <ResizableImage\n                  {...{\n                    translateX,\n                    item,\n                    currentIndex,\n                    index: i,\n                    isFirst,\n                    isLast: i === data.length - 1,\n                    length: data.length,\n                    renderItem,\n                    emptySpaceWidth,\n                    doubleTapScale,\n                    maxScale,\n                    disableTransitionOnScaledImage,\n                    hideAdjacentImagesOnScaledImage,\n                    disableVerticalSwipe,\n                    loop: isLoop,\n                    onScaleChange,\n                    onScaleChangeRange,\n                    setRef,\n                    disablePinchToZoom,\n                    ...eventsCallbacks,\n                    ...dimensions,\n                  }}\n                />\n              )}\n            </View>\n          );\n        })}\n      </Animated.View>\n    </View>\n  );\n};\n\nconst Gallery = React.forwardRef(GalleryComponent) as <T extends any>(\n  p: GalleryProps<T> & { ref?: GalleryReactRef }\n) => React.ReactElement;\n\nexport default Gallery;\n"]}